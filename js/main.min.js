$(function(){"use strict";function l(){var t=new $.RestClient("/steam-weeklong-deals/api/");e=t.add("sale"),n=t.add("details",{isSingle:!0}),n.add("app"),n.add("sub"),i=t.add("ratings",{isSingle:!0}),i.add("app")}function d(t){var e=t.indexOf("?"),n=t.substring(0,-1!==e?e:t.length);return n.lastIndexOf("/")===n.length-1&&(n=n.substring(0,n.lastIndexOf("/"))),n}function s(e){$("#load-count").html("Loaded "+a.length+" of "+t.length+" entries..."),e||$("#cache-warning").removeClass("hidden")}function o(t){var e=0,n=0;return $.each(t,function(t,i){var a=$(i.html),l=a.find("div.title").length;e+=l,n+=l-a.find("div.title:contains('Not Recommended')").length}),0===e?"0%":Math.round(n/e*100)+"%"}function f(t){var e=t.find("div.OS"),n=[];return 1===e.find(".win").length&&n.push(" Windows"),1===e.find(".mac").length&&n.push(" Mac"),1===e.find(".linux").length&&n.push(" Linux"),n}function r(t,e){var l=$(e),r=d(l.find("a").attr("href")),c=r.lastIndexOf("/"),u=r.substring(c+1),h='<a href="'+r+'" target="_blank">'+u+"</a>",p=l.find(".info .percent").first().text(),m=l.find(".info .price span.was").first().text(),g=l.find(".info .price span").last().text(),v=r.substring(c-3,c),x=f(l);"app"===v?$.when(n.app.read(u),i.app.read(u)).done(function(t,e){var n=$(t[0].html).find("h4").first().text(),i=o(e[0].ratings);a.push([h,n,p,m,g,i,x]),s(t[0].cached||e[0].cached)}):"sub"===v&&n.sub.read(u).done(function(t){var e=$(t.html).find("h4").first().text();a.push([h,e,p,m,g,"",x]),s(t.cached)})}function c(){e.read("weeklongdeals").done(function(e){t=$(e.html).find(".item"),t.each(r)})}function u(){$(document).ajaxStop(function(){var t=$("#deals-table").DataTable({data:a,columns:[{title:"App ID",type:"html-num-fmt"},{title:"Name",type:"string"},{title:"Discount",type:"num-fmt"},{title:"Was",type:"num-fmt"},{title:"Now",type:"num-fmt"},{title:"Rating*",type:"num-fmt"},{title:"OS",type:"string"}]});$("#deals-table_filter input").attr("placeholder","Search All"),$("#deals-table tfoot th.filter-text").each(function(){var t=$("#deals-table thead th").eq($(this).index()).text();$(this).html('<input type="text" class="form-control input-sm" placeholder="Search '+t+'" />')}),$("#deals-table tfoot th.filter-os").each(function(){$(this).html($("#components .select-os").clone().html())}),t.columns().eq(0).each(function(e){$("input",t.column(e).footer()).on("keyup change",function(){t.column(e).search(this.value).draw()}),$("select",t.column(e).footer()).on("change",function(){t.column(e).search(this.value).draw()})}),$(".hide-on-load").addClass("hidden"),$(".show-on-load").removeClass("hidden")})}function h(){l(),c(),u()}var t,e,n,i,a=[];h()});