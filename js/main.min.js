$(function(){"use strict";function d(){var t=new $.RestClient("/steam-weeklong-deals/api/");n=t.add("sale"),e=t.add("details",{isSingle:!0}),e.add("app"),e.add("sub"),a=t.add("ratings",{isSingle:!0}),a.add("app")}function s(t){var n=t.indexOf("?"),e=t.substring(0,-1!==n?n:t.length);return e.lastIndexOf("/")===e.length-1&&(e=e.substring(0,e.lastIndexOf("/"))),e}function r(t,n){return $("<a>",{href:t,text:n,target:"_blank"}).wrapAll("<div>").parent().html()}function l(n){$("#load-count").html("Loaded "+i.length+" of "+t.length+" entries..."),n||$("#cache-warning").removeClass("hidden")}function f(t){var n=0,e=0;return $.each(t,function(t,a){var i=$(a.html),d=i.find("div.title").length;n+=d,e+=d-i.find("div.title:contains('Not Recommended')").length}),Math.round(e/n*100)+"%"}function o(t,n){var d=$(n),o=s(d.find("a").attr("href")),u=o.lastIndexOf("/"),c=o.substring(u+1),h=r(o,c),p=d.find(".info .percent").first().text(),g=d.find(".info .price span.was").first().text(),m=d.find(".info .price span").last().text(),v=o.substring(u-3,u);"app"===v?$.when(e.app.read(c),a.app.read(c)).done(function(t,n){var e=$(t[0].html).find("h4").first().text(),a=f(n[0].ratings);i.push([h,e,p,g,m,a]),l(t[0].cached||n[0].cached)}):"sub"===v&&e.sub.read(c).done(function(t){var n=$(t.html).find("h4").first().text();i.push([h,n,p,g,m,""]),l(t.cached)})}function u(){n.read("weeklongdeals").done(function(n){t=$(n.html).find(".item"),t.each(o)})}function c(){$(document).ajaxStop(function(){$("#ajax-loader").hide(),$("#deals-table").dataTable({data:i,columns:[{title:"App ID",type:"html-num-fmt"},{title:"Name",type:"string"},{title:"Discount",type:"num-fmt"},{title:"Was",type:"num-fmt"},{title:"Now",type:"num-fmt"},{title:"Rating*",type:"num-fmt"}]}),$(".show-on-load").removeClass("hidden")})}function h(){d(),u(),c()}var t,n,e,a,i=[];h()});