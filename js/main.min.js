$(function(){"use strict";function d(){var t=new $.RestClient("/steam-weeklong-deals/api/");n=t.add("sale"),e=t.add("details",{isSingle:!0}),e.add("app"),e.add("sub"),i=t.add("ratings",{isSingle:!0}),i.add("app")}function l(t){var n=t.indexOf("?"),e=t.substring(0,-1!==n?n:t.length);return e.lastIndexOf("/")===e.length-1&&(e=e.substring(0,e.lastIndexOf("/"))),e}function s(t,n){return $("<a>",{href:t,text:n,target:"_blank"}).wrapAll("<div>").parent().html()}function f(n){$("#load-count").html("Loaded "+a.length+" of "+t.length+" entries..."),n||$("#cache-warning").removeClass("hidden")}function o(t){var n=0,e=0;return $.each(t,function(t,i){var a=$(i.html),d=a.find("div.title").length;n+=d,e+=d-a.find("div.title:contains('Not Recommended')").length}),Math.round(e/n*100)+"%"}function r(t){var n=t.find("div.OS"),e=[];return 1===n.find(".win").length&&e.push(" Windows"),1===n.find(".mac").length&&e.push(" Mac"),1===n.find(".linux").length&&e.push(" Linux"),e}function u(t,n){var d=$(n),u=l(d.find("a").attr("href")),c=u.lastIndexOf("/"),h=u.substring(c+1),p=s(u,h),m=d.find(".info .percent").first().text(),g=d.find(".info .price span.was").first().text(),v=d.find(".info .price span").last().text(),x=u.substring(c-3,c),w=r(d);"app"===x?$.when(e.app.read(h),i.app.read(h)).done(function(t,n){var e=$(t[0].html).find("h4").first().text(),i=o(n[0].ratings);a.push([p,e,m,g,v,i,w]),f(t[0].cached||n[0].cached)}):"sub"===x&&e.sub.read(h).done(function(t){var n=$(t.html).find("h4").first().text();a.push([p,n,m,g,v,"",w]),f(t.cached)})}function c(){n.read("weeklongdeals").done(function(n){t=$(n.html).find(".item"),t.each(u)})}function h(){$(document).ajaxStop(function(){var t=$("#deals-table").DataTable({data:a,columns:[{title:"App ID",type:"html-num-fmt"},{title:"Name",type:"string"},{title:"Discount",type:"num-fmt"},{title:"Was",type:"num-fmt"},{title:"Now",type:"num-fmt"},{title:"Rating*",type:"num-fmt"},{title:"OS",type:"string"}]});$("#deals-table_filter input").attr("placeholder","Search All"),$("#deals-table tfoot th.filter-text").each(function(){var t=$("#deals-table thead th").eq($(this).index()).text();$(this).html('<input type="text" class="form-control input-sm" placeholder="Search '+t+'" />')}),t.columns().eq(0).each(function(n){$("input",t.column(n).footer()).on("keyup change",function(){t.column(n).search(this.value).draw()})}),$(".hide-on-load").addClass("hidden"),$(".show-on-load").removeClass("hidden")})}function p(){d(),c(),h()}var t,n,e,i,a=[];p()});