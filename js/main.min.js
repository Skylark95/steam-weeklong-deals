$(function(){"use strict";function s(){var t=new $.RestClient("/steam-weeklong-deals/api/");e=t.add("sale"),e.add("page"),n=t.add("details",{isSingle:!0}),n.add("app"),n.add("sub"),a=t.add("ratings",{isSingle:!0}),a.add("app")}function l(t){var e=t.indexOf("?"),n=t.substring(0,-1!==e?e:t.length);return n.lastIndexOf("/")===n.length-1&&(n=n.substring(0,n.lastIndexOf("/"))),n}function d(e){$("#load-count").html("Loaded "+i.length+" of "+t+" entries..."),e||$("#cache-warning").removeClass("hidden")}function r(t){var e=0,n=0;return $.each(t,function(t,a){var i=$(a.html),s=i.find("div.title").length;e+=s,n+=s-i.find("div.title:contains('Not Recommended')").length}),0===e?"0%":Math.round(n/e*100)+"%"}function o(t){var e=t.find("span.platform_img").parent(),n=[];return 1===e.find(".win").length&&n.push(" Windows"),1===e.find(".mac").length&&n.push(" Mac"),1===e.find(".linux").length&&n.push(" Linux"),n}function c(t,e){var s=$(e),c=l(s.attr("href")),u=c.lastIndexOf("/"),h=c.substring(u+1),f='<a href="'+c+'" target="_blank">'+h+"</a>",p=s.find("div.search_discount span").text(),m=s.find("div.search_price span strike").text(),g=s.find("div.search_price span strike").empty().parent().parent().text(),v=c.substring(u-3,u),x=o(s);"app"===v?$.when(n.app.read(h),a.app.read(h)).done(function(t,e){var n=$(t[0].html).find("h4").first().text(),a=r(e[0].ratings);i.push([f,n,p,m,g,a,x]),d(t[0].cached||e[0].cached)}):"sub"===v&&n.sub.read(h).done(function(t){var e=$(t.html).find("h4").first().text();i.push([f,e,p,m,g,"",x]),d(t.cached)})}function u(n){var a=n||1;e.page.read("weeklongdeals",a).done(function(e){var n=$(e.html).find("#search_result_container a.search_result_row");t+=n.length,n.length>=25&&u(a+1),n.each(c)})}function h(){$(document).ajaxStop(function(){var t=$("#deals-table").DataTable({data:i,columns:[{title:"App ID",type:"html-num-fmt"},{title:"Name",type:"string"},{title:"Discount",type:"num-fmt"},{title:"Was",type:"num-fmt"},{title:"Now",type:"num-fmt"},{title:"Rating*",type:"num-fmt"},{title:"OS",type:"string"}]});$("#deals-table_filter input").attr("placeholder","Search All"),$("#deals-table tfoot th.filter-text").each(function(){var t=$("#deals-table thead th").eq($(this).index()).text();$(this).html('<input type="text" class="form-control input-sm" placeholder="Search '+t+'" />')}),$("#deals-table tfoot th.filter-os").each(function(){$(this).html($("#components .select-os").clone().html())}),t.columns().eq(0).each(function(e){$("input",t.column(e).footer()).on("keyup change",function(){t.column(e).search(this.value).draw()}),$("select",t.column(e).footer()).on("change",function(){t.column(e).search(this.value).draw()})}),$(".hide-on-load").addClass("hidden"),$(".show-on-load").removeClass("hidden")})}function f(){s(),u(),h()}var e,n,a,t=0,i=[];f()});